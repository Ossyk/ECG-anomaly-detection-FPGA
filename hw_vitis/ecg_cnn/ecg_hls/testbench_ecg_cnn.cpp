/*
//mystery tb
#include <iostream>
#include <cstdlib>
#include <ctime>
#include "ecg_cnn.h"
#include "ap_int.h"

int main() {
    std::cout << "---- ECG CNN Mystery Test ----" << std::endl;

    static data_t input[INPUT_LEN];
    ap_uint<32> packed_out = 0;

    // Seed RNG for deterministic randomness
    srand(time(NULL));

    // -------------------------------------------------------------
    // I secretly pick whether to generate NORMAL or ABNORMAL signal
    // -------------------------------------------------------------
    bool is_abnormal = (rand() % 2 == 0);  // I choose this internally üòè

    if (is_abnormal) {
        std::cout << "Generating random pattern..." << std::endl;
        for (int i = 0; i < INPUT_LEN; i++) {
            // alternating high/low noise with small spikes
            input[i] = (i % 3 == 0) ? (data_t)(0.7 * 32767)
                                    : (data_t)((rand() % 4000) - 2000);
        }
    } else {
        std::cout << "Generating calm ECG waveform..." << std::endl;
        for (int i = 0; i < INPUT_LEN; i++) {
            // smooth sinusoidal-like pattern (normal)
            float t = (float)i / INPUT_LEN * 6.28318f;
            input[i] = (data_t)(8000 * sin(t));  // low amplitude
        }
    }

    // -------------------------------------------------------------
    // Run the model
    // -------------------------------------------------------------
    ecg_cnn(input, &packed_out);

    // -------------------------------------------------------------
    // Decode Q8.8 score and interpret
    // -------------------------------------------------------------
    uint8_t label = packed_out & 0x1;
    int16_t score_q8 = (int16_t)(packed_out >> 1);
    float prob = (float)score_q8 / 256.0f;

    std::cout << "Packed Output = 0x" << std::hex << packed_out.to_uint() << std::dec << std::endl;
    std::cout << "Decoded -> Label: " << (int)label
              << "  Raw score_q8: " << score_q8
              << "  Probability: " << prob << std::endl;

    if (prob >= 0.4f)
        std::cout << "üö® Classified as: ABNORMAL (prob ‚â• 0.4)" << std::endl;
    else
        std::cout << "üíö Classified as: NORMAL (prob < 0.4)" << std::endl;

    std::cout << "---- Mystery prediction complete ----" << std::endl;
    return 0;
}
*/


// ---------------------------------------------------------------------------
// Fake ECG test signal (Q3.9) for HLS C simulation
// SAME AS USED IN PYTHON (generated by fake_ecg())
// ---------------------------------------------------------------------------

#include <stdio.h>
#include "ecg_cnn.h"
#include <stdint.h>

static const int16_t fake_ecg_q39[INPUT_LEN] = {
    -296,-295,-295,-294,-293,-292,-292,-291,-290,-290,-289,-288,-288,-287,-286,-285,-285,-284,-283,-283,-282,-281,-281,-280,-279,-279,-278,-278,-277,-276,-276,-275,-275,-274,-273,-273,-272,-272,-271,-270,-270,-269,-269,-268,-268,-267,-267,-266,-266,-265,-265,-264,-264,-264,-263,-263,-262,-262,-262,-261,-261,-261,-260,-260,-260,-259,-259,-259,-258,-258,-258,-258,-257,-257,-257,-257,-257,-257,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-257,-257,-257,-257,-257,-256,-256,-255,-254,-253,-251,-249,-245,-242,-237,-232,-227,-221,-214,-208,-202,-196,-191,-187,-185,-184,-184,-187,-190,-195,-201,-208,-215,-222,-229,-236,-243,-248,-254,-258,-262,-265,-268,-271,-274,-278,-284,-292,-304,-320,-340,-361,-381,-395,-402,-400,-389,-371,-351,-330,-311,-294,-277,-258,-235,-203,-161,-106,-37,44,135,230,323,405,468,505,512,488,436,361,272,175,80,-8,-85,-148,-199,-237,-267,-292,-315,-341,-370,-404,-439,-473,-499,-512,-510,-493,-466,-433,-401,-373,-351,-336,-327,-322,-320,-319,-319,-319,-320,-320,-321,-322,-322,-323,-323,-324,-324,-325,-325,-326,-326,-327,-327,-328,-328,-328,-329,-329,-330,-330,-330,-331,-331,-331,-332,-332,-332,-333,-333,-333,-333,-334,-334,-334,-334,-334,-334,-333,-333,-332,-331,-330,-328,-325,-322,-319,-314,-309,-302,-295,-286,-276,-264,-251,-237,-221,-204,-186,-167,-148,-129,-110,-91,-73,-57,-43,-31,-22,-15,-11,-11,-14,-19,-28,-39,-52,-67,-84,-102,-121,-140,-159,-177,-195,-211,-227,-241,-254,-266,-276,-284,-292,-298,-303,-308,-311,-314,-316,-317,-318,-319,-320,-320,-320,-320,-319,-319,-319,-318,-318,-317,-316,-316,-315,-315,-314,-313,-313,-312,-311,-311,-310,-309,-309,-308,-307,-307,-306,-305,-305,-304,-303,-303,-302,-301,-301,-300,-299,-298,-298,-297,-296,-296,-295,-294,-293,-293,-292,-291,-291,-290,-289,-289,-288,-287,-287,-286,-285,-284,-284,-283,-282,-282,-281,-280,-280,-279,-279,-278,-277,-277,-276,-275,-275,-274,-274,-273,-272,-272,-271,-271,-270,-270,-269,-269,-268,-268,-267,-267,-266,-266,-265,-265,-264,-264,-263,-263,-263,-262,-262,-261,-261,-261,-260,-260,-260,-259,-259,-259,-259,-258,-258,-258,-258,-257,-257,-257,-257,-257,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-256,-257,-257,-257,-257,-257,-258,-258,-258,-258,-259,-259,-259,-260,-260,-260,-260,-261,-261,-262,-262,-262,-263,-263,-264,-264,-264,-265,-265,-266,-266,-267,-267,-268,-268,-269,-269,-270,-270,-271,-271,-272,-273,-273,-274,-274,-275,-276,-276,-277,-277,-278,-279,-279,-280,-281,-281,-282,-283,-283,-284,-285,-285,-286,-287,-287,-288,-289,-289,-290,-291,-292,-292,-293,-294,-294,-295,-296,-296,-297,-298,-299,-299,-300,-301,-301,-302,-303,-304,-304,-305,-306,-306,-307,-308,-308,-309,-310,-310,-311,-312,-312,-313,-314,-314,-315,-315,-316,-317,-317,-318,-318,-319,-320,-320,-321,-321,-322,-322,-323,-323,-324,-324,-325,-325,-326,-326,-327,-327,-328,-328,-329,-329,-329,-330,-330,-331,-331,-331,-332,-332,-332,-333,-333,-333,-333,-334,-334,-334,-334,-335,-335,-335,-335,-335,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-336,-335,-335,-335,-335,-335,-334,-334,-334,-334,-334,-333,-333,-333,-332,-332,-332,-331,-331,-331,-330,-330,-330,-329,-329,-328,-328,-327,-327,-327,-326,-326,-325,-325,-324,-324,-323,-323,-322,-321,-321,-320,-320,-319,-319,-318,-317,-317,-316,-316,-315,-314,-314,-313,-312,-312,-311,-310,-310,-309,-308,-308,-307,-306,-306,-305,-304,-304,-303,-302,-302,-301,-300,-299,-299,-298,-297,-297,-296
};



int main() {
    static ap_uint<32> packed_out;
    static data_t input[INPUT_LEN];

    // Load the Q3.9 samples into 32-bit data_t
    for (int i = 0; i < INPUT_LEN; i++) {
        input[i] = (data_t) fake_ecg_q39[i];
    }

    // Run model
    ecg_cnn(input, &packed_out);

    uint8_t label = packed_out & 0x1;
    int16_t score_q8 = (packed_out >> 1) & 0xFFFF;

    printf("\n=== HLS SIM RESULT ===\n");
    printf("Label = %d\n", label);
    printf("Score_q8 = %d\n", score_q8);
    printf("======================\n");

    return 0;
}
